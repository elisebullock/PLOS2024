scale_color_manual(values = colors) +
geom_point(aes(y = NN_data, color = "Ki67 low"), size = 2)+
geom_line(aes(y = NN_model, color = "Ki67 low"), size = 2)+
labs(x = "Time since stop of treatment", y = "Cell count", color = "")+
facet_wrap(~receptor) +
theme_bw()+
theme(axis.text=element_text(size=smaller.font.size),
axis.title.x=element_text(size=larger.font.size,face="bold", margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size,face="bold"),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = c(0.1, 0.15),
#legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold"))+
scale_x_log10(limits=c(6,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(limits=c(100, 3e5), breaks=c(3e2, 1e3,  3e3, 1e4, 3e4, 1e5, 3e5), labels = ggplot_scientific_notation_axes_labels)+
coord_cartesian(xlim=c(7,65))
plots_N
all_data_model_correct_times
all_data_model_correct_times$K_high_data
all_data_model_correct_times <- all_data_model_correct_times[which(all_data_model_correct_times$time>6),]
all_data_model_correct_times <- all_data_model_correct_times[which(all_data_model_correct_times$time<67),]
colors <- c("Ki67 low" = "#D0D3D4", "Ki67 high" = "#34495E")
library(ggplot2)
library(scales)
plots_N <- ggplot(filter(all_data_model_correct_times, NP_data>100), aes(x =  time))+
geom_point(aes(y = NP_data, color = "Ki67 high"), size = 2)+
geom_line(aes(y = NP_model, color = "Ki67 high"), size = 2) +
scale_color_manual(values = colors) +
geom_point(aes(y = NN_data, color = "Ki67 low"), size = 2)+
geom_line(aes(y = NN_model, color = "Ki67 low"), size = 2)+
labs(x = "Time since stop of treatment", y = "Cell count", color = "")+
facet_wrap(~receptor) +
theme_bw()+
theme(axis.text=element_text(size=smaller.font.size),
axis.title.x=element_text(size=larger.font.size,face="bold", margin = margin(t = 10, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size,face="bold"),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = c(0.1, 0.15),
#legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold"))+
scale_x_log10(limits=c(6,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(limits=c(250, 3e5), breaks=c(3e2, 1e3,  3e3, 1e4, 3e4, 1e5, 3e5), labels = ggplot_scientific_notation_axes_labels)+
coord_cartesian(xlim=c(7,65))
plots_N
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
packages <- c("tidyverse", "ggplot2", "cowplot", "readr", "gridExtra")
lapply(packages, require, character.only = TRUE)
flow_frac_table <- read_rds(file = "flow_frac_table.Rds")
flow_frac_table_mouseID <- read_rds(file = "flow_frac_table_mouseID.Rds")
#flow_frac_table <- flow_frac_table[which(flow_frac_table$time >6 & flow_frac_table$time <67),]
flow_frac_table_mouseID <- flow_frac_table_mouseID[which(flow_frac_table_mouseID$time >6 & flow_frac_table_mouseID$time <67),]
flow_frac_table_mouseID <- flow_frac_table_mouseID[-11]
age_data <- read.csv("../data/MouseAges-Start-End.csv")
names(flow_frac_table_mouseID )[names(flow_frac_table_mouseID) == 'MouseID'] <- 'exptID'
full_frac <- merge(flow_frac_table_mouseID, age_data, by = c("exptID"))
#group by age
full_frac <- full_frac %>%
mutate(group = ifelse(age_at_start < 60, 1,
ifelse(60 <= age_at_start & age_at_start <= 80, 2,
ifelse(80 < age_at_start & age_at_start < 100, 3, 4))))
full_frac$group <- as.factor(full_frac$group)
ggplot_scientific_notation_axes_labels <- function(l) {
# 'prettyNum' puts things into scientific notation when digit strings get past a certain length,
# but keeps things  >0.0001 and < 10^7 in non-sci notation
l <- prettyNum(l)
# â€¦ but for axis labels, we want to switch to powers of 10 for anything >=10^3 or < 0.01
# (though you decide)
for(i in 1:length(l)){
number=eval(parse(text=l)[i])
if(!is.na(number) & (number<0.001 | number>=1000)) l[i]=format(number, scientific=TRUE)
}
# quote the part before the exponent to keep all the digits
l <- gsub("^(.*)e", "'\\1'e", l)
# remove + after exponent, if exists. E.g.: (e^+2 -> e^2)
l <- gsub("e\\+","e",l)
l <- gsub("e0","e",l)
l <- gsub("e-0","e-",l)
# turn the 'e' into plotmath format
l <- gsub("e", "%*%10^", l)
# convert 1x10^ or 1.000x10^ -> 10^
l <- gsub("\\'1[\\.0]*\\'\\%\\*\\%", "", l)
# convert 0.000.. * 10^x to 0
l <- gsub("\\'0[\\.0]*\\'\\%\\*\\%", "", l)
l <- gsub("10\\^0", "0", l)
# return this as an expression
parse(text=l)
}
# x axis major tick marks - corresponding to time post START treatment
major.ticks.actual.times=c(7,10,15, 25,35,45,55,65, 75)
major.ticks.time.post.tx=as.character(major.ticks.actual.times-5)
# Option to put some gaps in this label list to stop numbers overlapping
#shifted.time.labels[shifted.time.labels=="50"] = ""
#shifted.time.labels[shifted.time.labels=="70"] = ""
# minor breaks
mb=c(6:75)
plotwidth=12
golden.ratio=1.618
smaller.font.size=19
larger.font.size=21
legend.font.size=11
panel.label.size = 24
point_line_size = 1
lwidth =1.5
xlab.text = "Time since end of tamoxifen treatment (days)"
x.axis.label.offset= 10
thymus.colour= "orange"
flow_frac_plot_N <-  ggplot(flow_frac_table , aes(x = time))+
geom_point(aes(y = N_data), color = "darkgrey", size = 2)+
facet_wrap(~celltype)+
geom_line(aes(y = N_model), color = "black", size = 2)+
labs(x = "", y = bquote(bold('YFP')^bold('+')~bold('cell numbers'))) +
theme_bw()+
theme(axis.text=element_text(size=larger.font.size),
axis.title.x=element_text(size=larger.font.size, margin = margin(t = -10, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = "bottom",
legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold",size=larger.font.size))+
scale_x_log10(limits=c(7,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(minor_breaks=NULL, labels = ggplot_scientific_notation_axes_labels)+
coord_cartesian(xlim=c(7,65)) # trims the x-axis
flow_frac_plot <-  ggplot(filter(flow_frac_table, lp_data>0), aes(x = time))+
geom_point(aes(y = lp_data), color = "darkgrey", size = lwidth)+
facet_wrap(~celltype)+
geom_line(aes(y = lp_model), color = "black", size = 2)+
labs(x = "Time since end of tamoxifen treatment (days) ",
y = bquote(bold('Fraction Ki67')^bold('+')~bold('of YFP')^bold('+')))+
theme_bw()+
theme(axis.text=element_text(size=larger.font.size),
axis.title.x=element_text(size=larger.font.size, face="bold", margin = margin(t = 20, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = "bottom",
legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold",size=larger.font.size))+
scale_x_log10(limits=c(7,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(minor_breaks=NULL, labels = ggplot_scientific_notation_axes_labels)+
coord_cartesian(xlim=c(7,65)) # trims the x-axis
z= plot_grid(flow_frac_plot_N,flow_frac_plot,ncol=1, align="hv", labels = c('A', 'B'), label_size = panel.label.size)
pdf("../figures/fig_6.pdf", width=plotwidth, height=plotwidth*0.8)
print(z)
dev.off()
pdf("../../Manuscript/PaperFigures/Figure-6.pdf", width=plotwidth, height=0.8*plotwidth)
print(z)
dev.off()
flow_frac_plot_N <-  ggplot(full_frac , aes(x = time))+
geom_point(aes(y = N_data, color = group), size = 2)+
facet_wrap(~celltype)+
geom_line(aes(y = N_model), color = "black", size = lwidth)+
labs(color = "",x = "", y = bquote(bold('YFP')^bold('+')~bold('cell numbers'))) +
theme_bw()+
theme(axis.text=element_text(size=larger.font.size),
axis.title.x=element_text(size=larger.font.size, margin = margin(t = -10, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = "bottom",
legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold",size=larger.font.size))+
scale_x_log10(limits=c(7,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(minor_breaks=NULL, labels = ggplot_scientific_notation_axes_labels)+
scale_color_manual(labels = c("< 60", "60-80", "80-100", "> 100", "NA"), values = c("#A9CCE3","#82E0AA", "#2471A3", "#1E8449", "#f5f5f5"))
coord_cartesian(xlim=c(7,65)) # trims the x-axis
flow_frac_plot <-  ggplot(filter(full_frac, lp_data>0), aes(x = time))+
geom_point(aes(y = lp_data, color = group), size = 2)+
facet_wrap(~celltype)+
geom_line(aes(y = lp_model), color = "black", size = lwidth)+
labs(color = "",x = "Time since end of tamoxifen treatment (days) ",
y = bquote(bold('Fraction Ki67')^bold('+')~bold('of YFP')^bold('+')))+
theme_bw()+
theme(axis.text=element_text(size=larger.font.size),
axis.title.x=element_text(size=larger.font.size, face="bold", margin = margin(t = 20, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = "bottom",
legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold",size=larger.font.size))+
scale_x_log10(limits=c(7,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(minor_breaks=NULL, labels = ggplot_scientific_notation_axes_labels)+
scale_color_manual(labels = c("< 60", "60-80", "80-100", "> 100", "NA"), values = c("#A9CCE3","#82E0AA", "#2471A3", "#1E8449", "#f5f5f5"))
coord_cartesian(xlim=c(7,65)) # trims the x-axis
flow_frac_plot
z= plot_grid(flow_frac_plot_N,flow_frac_plot,ncol=1, align="hv", labels = c('A', 'B'), label_size = panel.label.size,shared_legend = TRUE, rel_heights = c(1, 1,0.1), axis = "lr")
pdf("../figures/fig_6_age_colour.pdf", width=plotwidth, height=plotwidth)
print(z)
dev.off()
pdf("../../Manuscript/PaperFigures/Figure-6-age-colour.pdf", width=plotwidth, height=plotwidth)
print(z)
dev.off()
flow_frac_plot_N <-  ggplot(full_frac , aes(x = time))+
geom_point(aes(y = N_data, size = age_at_start), color = "grey")+
facet_wrap(~celltype)+
geom_line(aes(y = N_model), color = "black", size = lwidth)+
labs(size = "Age at start",x = "", y = bquote(bold('YFP')^bold('+')~bold('cell numbers'))) +
theme_bw()+
theme(axis.text=element_text(size=larger.font.size),
axis.title.x=element_text(size=larger.font.size, margin = margin(t = -10, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = "bottom",
legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold",size=larger.font.size))+
scale_x_log10(limits=c(7,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(minor_breaks=NULL, labels = ggplot_scientific_notation_axes_labels)+
#scale_color_manual(labels = c("< 60", "60-80", "80-100", "> 100", "NA"), values = c("#A9CCE3","#82E0AA", "#2471A3", "#1E8449", "#f5f5f5"))
coord_cartesian(xlim=c(7,65)) # trims the x-axis
flow_frac_plot <-  ggplot(filter(full_frac, lp_data>0), aes(x = time))+
geom_point(aes(y = lp_data, size = age_at_start), color = "grey")+
facet_wrap(~celltype)+
geom_line(aes(y = lp_model), color = "black", size = lwidth)+
labs(size = "Age at start of treatment",x = "Time since end of tamoxifen treatment (days) ",
y = bquote(bold('Fraction Ki67')^bold('+')~bold('of YFP')^bold('+')))+
theme_bw()+
theme(axis.text=element_text(size=larger.font.size),
axis.title.x=element_text(size=larger.font.size, face="bold", margin = margin(t = 20, r = 0, b = 0, l = 0)),
axis.title.y=element_text(size=larger.font.size),
plot.title = element_text(hjust = 0.5),
text = element_text(family = "Helvetica", size = larger.font.size),
legend.position = "bottom",
legend.key = element_rect(fill = "transparent"),
strip.background = element_rect(color = "black", fill = "#FBFCFC"),
strip.text = element_text(face = "bold",size=larger.font.size))+
scale_x_log10(limits=c(7,75), breaks=major.ticks.actual.times, minor_breaks = mb, labels=major.ticks.time.post.tx)+
scale_y_log10(minor_breaks=NULL, labels = ggplot_scientific_notation_axes_labels)+
#scale_color_manual(labels = c("< 60", "60-80", "80-100", "> 100", "NA"), values = c("#A9CCE3","#82E0AA", "#2471A3", "#1E8449", "#f5f5f5"))
coord_cartesian(xlim=c(7,65)) # trims the x-axis
flow_frac_plot
z= plot_grid(flow_frac_plot_N,flow_frac_plot,ncol=1, align="hv", labels = c('A', 'B'), label_size = panel.label.size,shared_legend = TRUE, rel_heights = c(1, 1,0.1), axis = "lr")
pdf("../figures/fig_6_age_size.pdf", width=plotwidth, height=plotwidth)
print(z)
dev.off()
pdf("../../Manuscript/PaperFigures/Figure-6-age-size.pdf", width=plotwidth, height=plotwidth)
print(z)
dev.off()
source("/Users/andy/Dropbox/Documents/Projects/Collaborations/Eva Lukas/R scripts clean for submission/scripts_figures/fig_5.Rmd")
update.packages(ask=FALSE)
f=function(x){ 0.5*exp(-t/4) + 0.2*exp(-t/30) + 0.2*exp(-t/60) + 0.1*exp(-t/100)}
tp=seq(0,200, 0,1)
plot(f(tp)~tp, log="y")
tp=seq(0,200,0.01)
plot(f(tp)~tp, log="y")
f=function(x){ 0.5*exp(-x/4) + 0.2*exp(-x/30) + 0.2*exp(-x/60) + 0.1*exp(-x/100)}
tp=seq(0,200,0.01)
plot(f(tp) ~ tp, log="y")
plot(f(tp) ~ tp, log="y", type="l")
mix=c(0.8, 0.05, 0.04,0.05)
mix=c(0.8, 0.05, 0.04,0.05)
timescale=c(4, 30, 60, 100)
sum(mix*exp(-x*timescale))
sum(mix*exp(-1*timescale))
source("~/.active-rstudio-document")
f=function(x){
mix=c(0.8, 0.05, 0.04,0.05)
timescale=c(4, 30, 60, 100)
y=0
for(i in 1:length(mix)){
y=y+mix[i]*exp(-x/timescale[i])
}
return(y)
}
tp=seq(0,200,0.01)
plot(f(tp) ~ tp, log="y", type="l")
f=function(x){
mix=c(0.8, 0.02, 0.02,0.16)
timescale=c(4, 30, 60, 100)
y=0
for(i in 1:length(mix)){
y=y+mix[i]*exp(-x/timescale[i])
}
return(y)
}
tp=seq(0,200,0.01)
plot(f(tp) ~ tp, log="y", type="l")
timescale=c(4, 30, 60, 1000)
f=function(x){
mix=c(0.8, 0.02, 0.02,0.16)
timescale=c(4, 30, 60, 1000)
y=0
for(i in 1:length(mix)){
y=y+mix[i]*exp(-x/timescale[i])
}
return(y)
}
tp=seq(0,200,0.01)
plot(f(tp) ~ tp, log="y", type="l")
g=function(x){0.8*exp(-x/5) + 0.2*exp(-x/(20+5*x))}
tp=seq(0,200,0.01)
plot(g(tp) ~ tp, log="y", type="l")
g=function(x){0.8*exp(-x/5) + 0.2*exp(-x/(20+x))}
tp=seq(0,200,0.01)
plot(g(tp) ~ tp, log="y", type="l")
g=function(x){0.8*exp(-x/5) + 0.2*exp(-x/(20+x/5))}
tp=seq(0,200,0.01)
plot(g(tp) ~ tp, log="y", type="l")
g=function(x){0.9*exp(-x/5) + 0.1*exp(-x/(20+x/5))}
tp=seq(0,200,0.01)
plot(g(tp) ~ tp, log="y", type="l")
source("~/.active-rstudio-document")
library(ggplot2)
f=function(x){
mix=c(0.8, 0.02, 0.02,0.16)
timescale=c(4, 30, 60, 1000)
y=0
for(i in 1:length(mix)){
y=y+mix[i]*exp(-x/timescale[i])
}
return(y)
}
g=function(x){0.9*exp(-x/5) + 0.1*exp(-x/(20+x/5))}
tp=seq(0,200,0.01)
d=data.frame(x=tp, y=g(tp))
p=ggplot(d, aes(x=x, y=y)) + geom_line() +scale_y_continuous(trans='log10')
print(p)
p=ggplot(d, aes(x=x, y=y)) + geom_line() +scale_y_continuous(trans='log10') + theme_bw
print(p)
p=ggplot(d, aes(x=x, y=y)) + geom_line() +scale_y_continuous(trans='log10') + theme_bw()
print(p)
g=function(x){0.9*exp(-x/5) + 0.1*exp(-x/(20+x/5))}
tp=seq(0,400,0.01)
d=data.frame(x=tp, y=g(tp))
p=ggplot(d, aes(x=x, y=y)) + geom_line() +scale_y_continuous(trans='log10') + theme_bw()
print(p)
p=ggplot(d, aes(x=x, y=y)) + geom_line() +scale_y_log10() + theme_bw()
print(p)
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
p=ggplot(d, aes(x, y=y)) + geom_line() +scale_y_log10(minor_breaks =log10_minor_break()) + theme_bw() + xlim(0,400) +
geom_line(aes(x=x+100, y=y))
print(p)
p=ggplot(d, aes(x, y=y)) + geom_line() +scale_y_log10(minor_breaks =log10_minor_break()) + theme_bw() + xlim(0,400) +
geom_line(aes(x=x+100, y=y, colour="red")) +
geom_line(aes(x=x+200, y=y, colour="blue"))
print(p)
g=function(x){0.99*exp(-x/5) + 0.01*exp(-x/(20+x/5))}
tp=seq(0,400,0.1)
d=data.frame(x=tp, y=g(tp))
p=ggplot(d, aes(x, y=y)) + geom_line() +scale_y_log10(minor_breaks =log10_minor_break()) + theme_bw() + xlim(0,400) +
geom_line(aes(x=x+100, y=y, colour="red")) +
geom_line(aes(x=x+200, y=y, colour="blue"))
print(p)
g=function(x){0.9*exp(-x/5) + 0.1*exp(-x/(20+x/5))}
tp=seq(0,400,0.1)
d=data.frame(x=tp, y=g(tp))
p=ggplot(d, aes(x, y=y)) + geom_line() +scale_y_log10(minor_breaks =log10_minor_break()) + theme_bw() + xlim(0,400) +
geom_line(aes(x=x+100, y=y, colour="red")) +
geom_line(aes(x=x+200, y=y, colour="blue"))
print(p)
pdf("Memcurve.pdf",width=7.2,height=4)
print(p)
dev.off()
tp=seq(0,500,0.1)
d=data.frame(x=tp, y=g(tp))
p=ggplot(d, aes(x, y=y)) + geom_line() +scale_y_log10(minor_breaks =log10_minor_break()) + theme_bw() + xlim(0,400) +
geom_line(aes(x=x+100, y=y, colour="red")) +
geom_line(aes(x=x+200, y=y, colour="blue")) +
coord_cartesian(xlim=c(0,450))
print(p)
d=data.frame(x=tp, y=g(tp))
p=ggplot(d, aes(x, y=y)) + geom_line() +scale_y_log10(minor_breaks =log10_minor_break()) + theme_bw() + xlim(0,500) +
geom_line(aes(x=x+100, y=y, colour="red")) +
geom_line(aes(x=x+200, y=y, colour="blue")) +
coord_cartesian(xlim=c(0,450))
print(p)
source("~/Dropbox/Documents/Projects/Collaborations/BenSeddon/Memory BrDU Ki67 Chimeras/Paper/Elise draft 2022/Figures/Memcurve.R")
